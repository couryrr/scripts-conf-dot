#!/usr/bin/env bash

DEV_FOLDER="$HOME/Development"  # Change this to your development folder path
DEFAULT_SESSION="default"       # Default session name
FLOAT_WIDTH="80%"
FLOAT_HEIGHT="60%"

select_and_manage_session() {
    if [ ! -d "$DEV_FOLDER" ]; then
        echo "Error: Development folder '$DEV_FOLDER' does not exist"
        exit 1
    fi
    
    options=$(find "$DEV_FOLDER" -mindepth 1 -maxdepth 1 -type d)
    options="[DEFAULT SESSION]\n$options"
    
    selected=$(echo -e "$options" | fzf --prompt="Select project: " --height=40% --reverse)
    
    if [ -z "$selected" ]; then
        exit 0
    fi
    
    if [ "$selected" = "[DEFAULT SESSION]" ]; then
        session_name="$DEFAULT_SESSION"
        selected_dir="$HOME"  # Or whatever directory you want for default
    else
        selected_dir="$selected"
        session_name=$(basename "$selected_dir")
    fi
    
    if tmux has-session -t "$session_name" 2>/dev/null; then
        tmux switch-client -t "$session_name"
    else
        tmux new-session -d -s "$session_name" -c "$selected_dir"
        tmux switch-client -t "$session_name"
    fi
}

if [ -z "$TMUX" ]; then
    echo "This script must be run from within a tmux session"
    exit 1
fi

tmux display-popup -w "$FLOAT_WIDTH" -h "$FLOAT_HEIGHT" -E "bash -c 'DEV_FOLDER=\"$DEV_FOLDER\"; DEFAULT_SESSION=\"$DEFAULT_SESSION\"; $(declare -f select_and_manage_session); select_and_manage_session' || true"
